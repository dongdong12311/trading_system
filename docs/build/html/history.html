

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CHANGELOG &mdash; CNICPortofolio 0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="收集策略日志" href="development/collecting_logs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CNICPortofolio
          

          
          </a>

          
            
            
              <div class="version">
                0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">基础</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro/overview.html">介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro/tutorial.html">教程：均值方差模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro/examples.html">策略示例</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/base_api.html">基础 API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/extend_api.html">扩展 API</a></li>
</ul>
<p class="caption"><span class="caption-text">进阶</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro/run_algorithm.html">多种方式运行策略</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro/optimizing_parameters.html">参数调优</a></li>
</ul>
<p class="caption"><span class="caption-text">开发</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="development/make_contribute.html">如何贡献代码</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/basic_concept.html">基本概念</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/mod.html">Mod</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/event_source.html">扩展事件源</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/data_source.html">扩展数据源</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/collecting_logs.html">收集策略日志</a></li>
</ul>
<p class="caption"><span class="caption-text">其他</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">CHANGELOG</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">3.4.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">3.3.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">3.3.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">3.3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">3.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">3.1.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">3.1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">3.1.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">3.0.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id10">3.0.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id11">3.0.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">3.0.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id13">3.0.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id14">3.0.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id15">2.2.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id16">2.2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id17">2.2.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id18">2.2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id21">2.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id22">2.1.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id23">2.1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id24">2.1.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id25">2.1.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id26">2.0.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id27">2.0.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id28">2.0.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id29">2.0.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id30">2.0.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id31">2.0.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id35">0.3.14</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id36">0.3.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id37">0.3.12</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id38">0.3.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id39">0.3.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id40">0.3.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id41">0.3.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id42">0.3.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id43">0.3.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id44">0.3.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id45">0.3.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id46">0.3.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id47">0.3.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id48">0.3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id49">0.3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id50">0.0.53</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id51">0.0.20</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id52">0.0.19</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id53">0.0.18</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id54">0.0.16</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id55">0.0.15</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id56">0.0.14</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id57">0.0.12</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id58">0.0.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id59">0.0.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id60">0.0.1</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CNICPortofolio</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>CHANGELOG</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/history.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="changelog">
<span id="history"></span><h1>CHANGELOG<a class="headerlink" href="#changelog" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>3.4.0<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>新增</p>
<ul>
<li><p>股票下单 API 加入资金不足时自动转为使用所有剩余资金下单的功能，见 <a class="reference external" href="https://github.com/ricequant/rqalpha/tree/master/rqalpha/mod/rqalpha_mod_sys_accounts">rqalpha_mod_sys_accounts</a></p></li>
</ul>
</li>
<li><p>变更</p>
<ul>
<li><p>重构 <code class="code docutils literal notranslate"><span class="pre">rqalpha_mod_sys_accounts</span></code> 中的账户、持仓类，主要变化如下：</p>
<ul>
<li><p>持仓类拆分为两层，核心同时兼容期货和股票的逻辑，上层兼容绝大部分旧有 API</p></li>
<li><p>期货保证金的计算逻辑改为跟随行情变化的动态保证金、不再维护持仓序列</p></li>
<li><p>新增 <code class="code docutils literal notranslate"><span class="pre">position_pnl</span></code> 昨仓盈亏、<code class="code docutils literal notranslate"><span class="pre">trading_pnl</span></code> 交易盈亏字段</p></li>
<li><p>删除 <code class="code docutils literal notranslate"><span class="pre">holding_pnl</span></code> 持仓盈亏、<code class="code docutils literal notranslate"><span class="pre">realized_pnl</span></code> 实现盈亏字段</p></li>
<li><p>降低账户类和持仓类之间的耦合程度</p></li>
</ul>
</li>
<li><p>去掉配置项 <code class="code docutils literal notranslate"><span class="pre">base.resume_mode</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">extra.force_run_init_when_pt_resume</span></code>，相关判断移交给 <code class="code docutils literal notranslate"><span class="pre">PersistProvider</span></code> 实现</p></li>
<li><p>去掉 <code class="code docutils literal notranslate"><span class="pre">Booking</span></code> 类，相关逻辑合并至持仓类</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2>3.3.3<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>新增</p>
<ul>
<li><p>对期货 NR、UR、RR 的支持</p></li>
</ul>
</li>
<li><p>修复</p>
<ul>
<li><p>Python2.7 环境下依赖的 numpy 版本不正确的问题</p></li>
<li><p>进程启动后初次触发 settlement 事件时框架内部时间可能不正确的问题</p></li>
<li><p>期货下单 API 未拒绝不足一手的下单请求的问题</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id3">
<h2>3.3.2<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>新增</p>
<ul>
<li><p><code class="code docutils literal notranslate"><span class="pre">SelfTradeValidator</span></code> 模块，用于拦截策略可能产生自成交的订单</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">buy_close</span></code>、<code class="code docutils literal notranslate"><span class="pre">sell_close</span></code> API 将订单拆分成多个时给出 WARNING 提示</p></li>
<li><p>对股票更换代码这一行为的支持</p></li>
<li><p>对期货 CJ 品种的支持</p></li>
</ul>
</li>
<li><p>变更</p>
<ul>
<li><p>不再支持 Python3.4</p></li>
</ul>
</li>
<li><p>修复</p>
<ul>
<li><p><code class="code docutils literal notranslate"><span class="pre">Booking</span></code> 持久化逻辑错误的问题</p></li>
<li><p>指数的 <code class="code docutils literal notranslate"><span class="pre">Bar</span></code> 对象获取 <code class="code docutils literal notranslate"><span class="pre">limit_up</span></code>、<code class="code docutils literal notranslate"><span class="pre">limit_down</span></code> 字段报错的问题</p></li>
<li><p>策略订阅的合约交易时间与基准合约交易时间不一致会导致模拟交易报错退出的问题</p></li>
<li><p>股票在同一个交易日出现多次分红时计算有误的问题</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">order_value</span></code> 等 API 在市价单时计算下单量有误的问题</p></li>
<li><p>信号模式下仍然会拦截在标的涨跌停时下出的订单</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id4">
<h2>3.3.1<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>新增</p>
<ul>
<li><p>对期货 SP, EG 品种的支持。</p></li>
<li><p>加入 python3.7 环境下的自动化测试。</p></li>
<li><p>使用 <code class="code docutils literal notranslate"><span class="pre">run_func</span></code> 运行的策略不再需要显式地执行 <code class="code docutils literal notranslate"><span class="pre">from</span> <span class="pre">rqalpha.api</span> <span class="pre">import</span> <span class="pre">*</span></code>。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">update-bundle</span></code> 命令增加中断重试功能。</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">MinuteBarObject</span></code> 对象，当分钟线数据不包含涨跌停价时该对象的涨跌停字段改为从日线获取。</p></li>
</ul>
</li>
<li><p>变更</p>
<ul>
<li><p>年化（如收益率）的计算改为使用交易日而非是自然日。</p></li>
<li><p>基准收益率不再使用全仓买入基准合约模拟，改为直接使用前复权价格序列计算。</p></li>
<li><p>策略使用 <code class="code docutils literal notranslate"><span class="pre">subscribe_event</span></code> 注册的回调函数改为接收两个参数 <code class="code docutils literal notranslate"><span class="pre">context</span></code>, <code class="code docutils literal notranslate"><span class="pre">event</span></code>。</p></li>
<li><p>重构了 <code class="code docutils literal notranslate"><span class="pre">Booking</span></code> 的计算逻辑，增加了 <code class="code docutils literal notranslate"><span class="pre">trading_pnl</span></code>, <code class="code docutils literal notranslate"><span class="pre">position_pnl</span></code> 两个字段。</p></li>
<li><p>抽离 <code class="code docutils literal notranslate"><span class="pre">risk.py</span></code> 为 <a class="reference external" href="https://github.com/ricequant/rqrisk">rqrisk</a> 项目。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">order_value</span></code> 等使用价值计算股数的下单 API 计算股数时增加对税费的考虑（即计算包含税费的情况下花费一定数量的现金可以交易多少合约）。</p></li>
</ul>
</li>
<li><p>修复</p>
<ul>
<li><p>净值为负的情况下 <code class="code docutils literal notranslate"><span class="pre">Portfolio</span></code> 年化收益率计算有误的问题。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Portfolio</span></code> 对象不存在的情况下某些 API 的报错信息不明确的问题。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">RunInfo</span></code> 对象中的 <code class="code docutils literal notranslate"><span class="pre">commission_multiplier</span></code> 字段不正确的问题。</p></li>
<li><p>期货 tick 回测/模拟交易下滑点计算报错的问题。</p></li>
<li><p>模拟交易和实盘中调用 <code class="code docutils literal notranslate"><span class="pre">submit_order</span></code> 发送代码中包含 “88” 的股票订单报错的问题。</p></li>
<li><p>限价单 round price 的精度问题。</p></li>
<li><p>策略使用 <code class="code docutils literal notranslate"><span class="pre">subscribe_event</span></code> 注册的回调函数和框架内部逻辑触发顺序不可控的问题。</p></li>
<li><p>回测和模拟交易中股票市价单冻结和解冻的资金可能出现不一致的问题。</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id5">
<h2>3.2.0<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>配置和命令</p>
<ul>
<li><p><code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">run</span></code> 命令增加参数 <code class="code docutils literal notranslate"><span class="pre">-mk/--market</span></code>，用来标识策略交易标的所在的市场，如 cn、hk 等。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">update_bundle</span></code> 更改为 <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">update-bundle</span></code>。</p></li>
</ul>
</li>
<li><p>接口和 Mod</p>
<ul>
<li><p>增加新接口 <code class="code docutils literal notranslate"><span class="pre">AbstractTransactionCostDecider</span></code>，在 <code class="code docutils literal notranslate"><span class="pre">Environment</span></code> 中注册该接口的实现可以自定义不同合约品种、不同市场的税费计算逻辑。</p></li>
<li><p>增加新 Mod <code class="code docutils literal notranslate"><span class="pre">sys_transaction_cost</span></code> 实现上述接口，抽离了原 <code class="code docutils literal notranslate"><span class="pre">sys_simulation</span></code> Mod 中的税费计算逻辑，并加入了对港股税费计算的支持。</p></li>
<li><p>移除 <code class="code docutils literal notranslate"><span class="pre">sys_booking</span></code> Mod，booking 相关逻辑移入框架中，<code class="code docutils literal notranslate"><span class="pre">Booking</span></code> 与 <code class="code docutils literal notranslate"><span class="pre">Portfolio</span></code> 类地位相当。</p></li>
<li><p>移除 <code class="code docutils literal notranslate"><span class="pre">sys_stock_realtime</span></code> Mod，该 Mod 被移到了单独的仓库 <a class="reference external" href="https://github.com/ricequant/rqalpha-mod-stock-realtime">rqalpha-mod-stock-realtime</a> ，不再与框架一同维护。</p></li>
<li><p>移除 <code class="code docutils literal notranslate"><span class="pre">sys_stock_incremental</span></code> Mod，该 Mod 被移到了单独的仓库 <a class="reference external" href="https://github.com/ricequant/rqalpha-mod-incremental">rqalpha-mod-incremental</a> ，不再与框架一同维护。</p></li>
</ul>
</li>
<li><p>类型和 Api</p>
<ul>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">SimulationBooking</span></code> 类，实现了 <code class="code docutils literal notranslate"><span class="pre">Booking</span></code> 类相同的方法，用于在回测和模拟交易中兼容实盘 <code class="code docutils literal notranslate"><span class="pre">Booking</span></code> 相关的 Api。</p></li>
<li><p>增加 Api <code class="code docutils literal notranslate"><span class="pre">get_position</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">get_positions</span></code>，用来获取策略持仓的 <code class="code docutils literal notranslate"><span class="pre">BookingPosition</span></code> 对象。</p></li>
<li><p>增加 Api <code class="code docutils literal notranslate"><span class="pre">subscribe_event</span></code>，策略可以通过该 Api 注册回调函数，订阅框架内部事件。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">DEFAULT_ACCOUNT_TYPE</span></code> 枚举类增加债券 <code class="code docutils literal notranslate"><span class="pre">BOND</span></code> 类型。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">history_bars</span></code> 在 <code class="code docutils literal notranslate"><span class="pre">before_trading</span></code> 中调用时可以取到当日日线数据。</p></li>
<li><p>重构 <code class="code docutils literal notranslate"><span class="pre">Instrument</span></code> 类，该类所需的字段现在以 property 的形式写明，方便对 Instrument 对象的调用及对接第三方数据源。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Instrument</span></code> 类型新增字段 <code class="code docutils literal notranslate"><span class="pre">market_tplus</span></code>，用来标识合约对平仓时间的限制，例如有 T+1 限制的 A 股该字段值为1，港股为 0。</p></li>
</ul>
</li>
<li><p>逻辑</p>
<ul>
<li><p>更改 Benchmark 的买入逻辑，不再对买入数量进行取整，避免初始资金较小时 Benchmark 空仓的问题。</p></li>
<li><p>修正画图时最大回撤的计算逻辑。</p></li>
<li><p>修正年化收益的计算逻辑，年化的天数的计算使用 <code class="code docutils literal notranslate"><span class="pre">start_date</span></code>、<code class="code docutils literal notranslate"><span class="pre">end_date</span></code>，而非根据交易日历调整后的日期。</p></li>
<li><p>下单冻结资金时考虑税费。</p></li>
<li><p>前端风控验资时考虑税费。</p></li>
<li><p>修复了 <code class="code docutils literal notranslate"><span class="pre">before_trading</span></code> 中更新订阅池会可能会导致开盘收到错误 tick 的 Bug。</p></li>
<li><p>修复 beta 值为 0 时 plot result 出错的问题。</p></li>
<li><p>重构 A 股 T+1 的相关逻辑，移除 hard code。</p></li>
<li><p>滑点计算增加对涨跌停价的判断，现在有涨跌停价的合约滑点不会超出涨跌停价的范围。</p></li>
<li><p>修复在取不到行情时下单可能会抛出 RuntimeError 的 Bug。</p></li>
</ul>
</li>
<li><p>依赖</p>
<ul>
<li><p>在 Python2.7 和 Python3.4 环境中限制 Matplotlib 的版本。</p></li>
<li><p>移除了测试用例对 Pandas 的版本依赖。</p></li>
<li><p>不再限制 Pandas 的版本上限。</p></li>
<li><p>移除对 colorama 库的依赖。</p></li>
<li><p>限制 click 库的版本下限为 7.0。</p></li>
</ul>
</li>
<li><p>其他</p>
<ul>
<li><p>加入对期货 TS 品种的支持。</p></li>
<li><p>模拟交易和实盘中支持持久化自定义类型（可被 pickle 的自定义类型）。</p></li>
<li><p>增加了单元测试框架并添加了少量测试用例。</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id6">
<h2>3.1.2<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>修复上个版本打包时包含异常文件的问题。</p></li>
</ul>
</div>
<div class="section" id="id7">
<h2>3.1.1<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>修复 <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">mod</span> <span class="pre">uninstall</span></code> 命令不兼容 pip 10.0 以上版本的bug。</p></li>
<li><p>不再限制 logbook 库的版本上限。</p></li>
<li><p>python 2.7/3.5/3.6 环境下不再限制 bcolz 的版本上限。</p></li>
</ul>
</div>
<div class="section" id="id8">
<h2>3.1.0<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Api</p>
<ul>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">symbol(order_book_id,</span> <span class="pre">split=&quot;,</span> <span class="pre">&quot;)</span></code> 扩展Api，用于获取合约简称。</p></li>
<li><p>修改 <code class="code docutils literal notranslate"><span class="pre">current_snapshot(id_or_symbol)</span></code>，该 Api 支持在 before_trading/after_trading 中调用。</p></li>
<li><p>修改 <code class="code docutils literal notranslate"><span class="pre">history_bars</span></code>，增加对 <code class="code docutils literal notranslate"><span class="pre">frequency</span></code> 参数的检查。</p></li>
<li><p>修正 <code class="code docutils literal notranslate"><span class="pre">order(order_book_id,</span> <span class="pre">quantity,</span> <span class="pre">price=None,</span> <span class="pre">style=None)</span></code> 函数期货下单的逻辑。</p></li>
<li><p>修改股票下单接口，允许一次性申报卖出非100股整倍数的股票。</p></li>
<li><p>修改下单接口，当因参数检查或前端风控等原因创建订单失败时，接口返回 None 或空 list，并打印 warn。</p></li>
</ul>
</li>
<li><p>接口</p>
<ul>
<li><p><code class="code docutils literal notranslate"><span class="pre">AbstractDataSource</span></code> 接口增加 <code class="code docutils literal notranslate"><span class="pre">get_tick_size(instrument)</span></code> 方法，<code class="code docutils literal notranslate"><span class="pre">BaseDataSource</span></code> 实现了该方法。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">AbstractDataSource</span></code> 接口增加 <code class="code docutils literal notranslate"><span class="pre">history_ticks(instrument,</span> <span class="pre">count,</span> <span class="pre">fields,</span> <span class="pre">dt)</span></code> 方法，支持 tick 级别策略运行的 DataSource 应实现该方法。</p></li>
<li><p>增加通用下单接口 <code class="code docutils literal notranslate"><span class="pre">submit_order(id_or_ins,</span> <span class="pre">amount,</span> <span class="pre">side,</span> <span class="pre">price=None,</span> <span class="pre">position_effect=None)</span></code>，策略可以通过该接口自由选择参数下单。</p></li>
</ul>
</li>
<li><p>类</p>
<ul>
<li><p><code class="code docutils literal notranslate"><span class="pre">Instrument</span></code> 类新增 <code class="code docutils literal notranslate"><span class="pre">tick_size()</span></code> 方法。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">PersistHelper</span></code> 类新增 <code class="code docutils literal notranslate"><span class="pre">unregister(key)</span></code> 方法，可以调用该方法注销已经注册了持久化服务的模块。</p></li>
<li><p>新增 <code class="code docutils literal notranslate"><span class="pre">TickObject</span></code> 类，替代原 <code class="code docutils literal notranslate"><span class="pre">Tick</span></code> 类和 <code class="code docutils literal notranslate"><span class="pre">SnapshotObject</span></code> 类。可通过 <code class="code docutils literal notranslate"><span class="pre">TickObject</span></code> 对象的 asks, bids, ask_vols, bid_bols 四个属性获取买卖报盘。</p></li>
</ul>
</li>
<li><p>配置</p>
<ul>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">base.round_price</span></code> 参数，开启后现价单价格会被调整为最小价格变动单位的整倍数，对应的命令行参数为 <code class="code docutils literal notranslate"><span class="pre">--round-price</span></code>。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">sys_simulation</span> <span class="pre">Mod</span></code> 增加滑点模型 <code class="code docutils literal notranslate"><span class="pre">slippage_model</span></code> 参数，滑点不再限制为价格的比率，亦可使用基于最小价格变动单位的滑点模型，甚至加载自定义的滑点模型。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">sys_simulation</span> <span class="pre">Mod</span></code> 增加股票最小手续费 <code class="code docutils literal notranslate"><span class="pre">stock_min_commission</span></code> 参数，用于控制回测和模拟交易中单笔股票交易收取的最小手续费，对应的命令行参数为 <code class="code docutils literal notranslate"><span class="pre">--stock-min-commission</span> <span class="pre">5</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">sys_account</span> <span class="pre">Mod</span></code> 增加 <code class="code docutils literal notranslate"><span class="pre">future_forced_liquidation</span></code> 参数，开启后期货账户在爆仓时会被强平。</p></li>
</ul>
</li>
<li><p>其他</p>
<ul>
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/224">Issue 224</a> ， 解决了展示图像时图像不能被保存的问题。</p></li>
<li><p>策略运行失败时 return code 为 1。</p></li>
<li><p>开启 <code class="code docutils literal notranslate"><span class="pre">force_run_init_when_pt_resume</span></code> 参数时，策略启动前将会清空 universe。</p></li>
<li><p>移除对 <a class="reference external" href="https://github.com/Qix-/better-exceptions">better-exceptions</a> 库的依赖，可以通过安装并设置环境变量的方式获得更详细的错误栈。</p></li>
<li><p>修复 <code class="code docutils literal notranslate"><span class="pre">StockPosition</span></code> 类中股票卖空买回时计算平均开仓价格错误的 bug。</p></li>
<li><p>修复画图时最大回撤计算错误的 bug。</p></li>
<li><p>重构 <code class="code docutils literal notranslate"><span class="pre">Executor</span></code>，现在 EventSource 不再需要发出 SETTLEMENT 事件，框架会在第二个交易日 BEFORE_TRAINDG 事件前先发出 SETTLEMENT 事件，如果 EventSource 未发出 BEFORE_TRAINDG 事件，该事件会在第一个行情事件到来时被框架发出。</p></li>
<li><p>加入新 Mod <code class="code docutils literal notranslate"><span class="pre">rqalpha_mod_sys_incremental</span></code>，启用该 Mod 可以增量运行回测，方便长期跟踪策略而不必反复运行跑过的日期，详情参考文档 <a class="reference external" href="https://github.com/ricequant/rqalpha/blob/master/rqalpha/mod/rqalpha_mod_sys_incremental/README.rst">sys_incremental Mod README</a>。</p></li>
<li><p>加入新 Mod <code class="code docutils literal notranslate"><span class="pre">rqalpha_mod_sys_booking</span></code>，该 Mod 用于从外部加载仓位作为实盘交易的初始仓位，详情参考文档 <a class="reference external" href="https://github.com/ricequant/rqalpha/blob/master/rqalpha/mod/rqalpha_mod_sys_booking/README.rst">sys_booking Mod README</a>。</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id9">
<h2>3.0.10<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>支持期货合约：苹果（AP）、棉纱（CY）、原油（SC）</p></li>
<li><p>限制 <code class="code docutils literal notranslate"><span class="pre">better-exceptions</span></code>、<code class="code docutils literal notranslate"><span class="pre">bcolz</span></code> 库的版本</p></li>
<li><p>支持 pip 10.x</p></li>
<li><p>修复 tick 回测中夜盘前 before_trading 无法获取白天数据的问题</p></li>
<li><p>当 <code class="code docutils literal notranslate"><span class="pre">force_run_init_when_pt_resume</span></code> 开启时会清空 persist 的 universe</p></li>
<li><p>增加资金风控中对佣金的考虑</p></li>
<li><p>修复文档中若干 typo</p></li>
</ul>
</div>
<div class="section" id="id10">
<h2>3.0.9<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>限制 pandas 的版本为 0.18 ~ 0.20 ，因为 0.21 和 matplotlib 有些不兼容。</p></li>
</ul>
</div>
<div class="section" id="id11">
<h2>3.0.8<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>修复 <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">run</span> <span class="pre">--config</span></code> 参数</p></li>
<li><p>增加 ON_NORMAL_EXIT 的持久化模式，在 RQAlpha 成功运行完毕后进行 persist 。可以在盘后快速地根据昨日持久化数据继续运行回测来增量回测。</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">run</span> <span class="pre">--logger</span></code> 参数可以单独设置特定的 logger 的 level</p></li>
<li><p>增加 persist_provider 的检查</p></li>
<li><p>修复 <code class="code docutils literal notranslate"><span class="pre">get_prev_close</span></code></p></li>
<li><p>打印 mod 的启动状态信息，方便 debug</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">is_valid_price</span></code> 工具函数来判断价格是否有效</p></li>
<li><p>修复期货账户因为保证金变化导致total_value计算错误</p></li>
<li><p>重构股票账户 <code class="code docutils literal notranslate"><span class="pre">last_price</span></code> 更新</p></li>
<li><p>修复期货下单拒单是错误信息typo</p></li>
<li><p>当启动LIVE_TRADING模式的时候，跳过simulation_mod的初始化</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">run</span> <span class="pre">--position</span></code> 来设置初始仓位的功能</p></li>
<li></li>
</ul>
</div>
<div class="section" id="id12">
<h2>3.0.6<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>import 修改相对引用为绝对引用</p></li>
<li><p>重构配置文件读取功能，分为默认配置，用户配置，项目配置</p></li>
<li><p>重构 <cite>main()</cite> 的 <cite>tear_down</cite> 的调用</p></li>
<li><p>get_previous_trading_date(date, n=1) 增加参数 n</p></li>
<li><p>增加公募基金数据处理相关逻辑</p></li>
<li><p>修改 <cite>mod.tear_down</cite> ，如果单个 mod 在 tear_down 抛异常后，不影响其他 mod 继续 tear_down</p></li>
<li><p>scheduler bugfix</p></li>
<li><p>处理 persist 遇到的异常</p></li>
<li><p>修复 order get_state / set_state 缺失 transaction_cost, avg_price</p></li>
<li><p>修复 mod_sys_stock_realtime</p></li>
</ul>
</div>
<div class="section" id="id13">
<h2>3.0.2<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>取消在股票下单函数中对 <cite>order_book_id</cite> 类型的检查，现在您可以交易 <cite>ETF</cite>, <cite>LOF</cite>, <cite>FenjiMu</cite>, <cite>FenjiA</cite>, <cite>FenjiB</cite>, <cite>INDX</cite> 了</p></li>
<li><p>Merge <a class="reference external" href="https://github.com/ricequant/rqalpha/pull/170">PR 170</a> 解决自定义 <cite>volume limit</cite> 时显示数值不正确的问题。</p></li>
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/148">Issue 148</a> <cite>get_dividend()方法返回的类型是numpy.ndarray，而非pandas.DataFrame</cite></p></li>
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/169">Issue 169</a> 执行 <cite>rqalpha mod install ctp==0.2.0dev0</cite> 时错误的记录了库信息的问题</p></li>
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/158">Issue 158</a> 多次循环 <cite>run_file</cite> / <cite>run_code</cite> 时导致的内存泄漏的问题</p></li>
<li><p>Enhance <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/166">Issue 166</a> 启动参数支持 <cite>–no-stock-t1</cite> 来屏蔽股票 T + 1 导致今仓的限制</p></li>
<li><p>性能提升: 使用 <cite>bisect_right</cite> 代替 <cite>searchsorted</cite></p></li>
</ul>
</div>
<div class="section" id="id14">
<h2>3.0.0<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<p><strong>[For 开发/运行策略的用户]</strong></p>
<p>3.x 相比 2.x 进行了如下更改，如果您升级到 3.x 版本，请务必阅读以下内容，保证您的策略可以顺利启动和执行:</p>
<ul class="simple">
<li><p>命令行参数做出如下调整</p>
<ul>
<li><p>不再使用 <code class="code docutils literal notranslate"><span class="pre">-sc/--stock-starting-cash</span></code> 参数</p></li>
<li><p>不再使用 <code class="code docutils literal notranslate"><span class="pre">-fc/--future-starting-cash</span></code> 参数</p></li>
<li><p>不再使用 <code class="code docutils literal notranslate"><span class="pre">-i/--init-cash</span></code> 参数</p></li>
<li><p>不再使用 <code class="code docutils literal notranslate"><span class="pre">-s/--security</span></code> 参数</p></li>
<li><p>不再使用 <code class="code docutils literal notranslate"><span class="pre">-k/--kind</span></code> 参数</p></li>
<li><p>不再使用 <code class="code docutils literal notranslate"><span class="pre">--strategy-type</span></code> 参数</p></li>
<li><p><strong>使用</strong> <code class="code docutils literal notranslate"><span class="pre">--account</span></code> 来替代，具体用法如下</p></li>
</ul>
</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 策略通过命令行运行，设置可交易类型是股票，起始资金为 10000</span>
$ rqalpha run --account stock <span class="m">10000</span>
<span class="c1"># 策略通过命令行运行，设置可交易类型为期货，起始资金为 50000</span>
$ rqalpha run --account future <span class="m">50000</span>
<span class="c1"># 策略通过命令行运行，设置可交易类型为期货和股票，起始资金分别为 股票 10000, 期货 50000</span>
$ rqalpha run --account stock <span class="m">10000</span> --account future <span class="m">50000</span>
<span class="c1"># 如果您通过 Mod 扩展，自定义了一种可交易类型(假设是huobi)，您也可以增加对于火币的支持和起始资金设置</span>
$ rqalpha run --account stock <span class="m">10000</span> --account future <span class="m">50000</span> --account huobi <span class="m">20000</span>
</pre></div>
</div>
<ul class="simple">
<li><p>相应，如果您通过 <code class="code docutils literal notranslate"><span class="pre">run_file</span> <span class="pre">|</span> <span class="pre">run_code</span> <span class="pre">|</span> <span class="pre">run_func</span></code> 来启动策略，配置文件及配置信息也做了对应的调整:</p>
<ul>
<li><p>不再使用 <code class="code docutils literal notranslate"><span class="pre">base.stock_starting_cash</span></code></p></li>
<li><p>不再使用 <code class="code docutils literal notranslate"><span class="pre">base.future_starting_cash</span></code></p></li>
<li><p>不再使用 <code class="code docutils literal notranslate"><span class="pre">base.securities</span></code></p></li>
<li><p><strong>使用</strong> <code class="code docutils literal notranslate"><span class="pre">base.accounts</span></code> 来替代，具体用法如下:</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 策略通过配置，设置可交易类型是股票，起始资金为 10000</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;matching_type&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;benchmark&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accounts&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;stock&quot;</span><span class="p">:</span> <span class="mi">10000</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1"># 策略通过配置，设置可交易类型是期货，起始资金为 50000</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;matching_type&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;benchmark&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accounts&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;future&quot;</span><span class="p">:</span> <span class="mi">50000</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1"># 策略通过配置，设置可交易类型为期货和股票，起始资金分别为 股票 10000, 期货 50000</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;matching_type&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;benchmark&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accounts&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;stock&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
      <span class="s2">&quot;future&quot;</span><span class="p">:</span> <span class="mi">50000</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1"># 如果您通过 Mod 扩展，自定义了一种可交易类型(假设是huobi)，您也可以增加对于火币的支持和起始资金设置</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;matching_type&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;benchmark&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accounts&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;stock&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
      <span class="s2">&quot;future&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>
      <span class="s2">&quot;huobi&quot;</span><span class="p">:</span> <span class="mi">20000</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>[For Mod developer]</strong></p>
<p>本次更新可能导致已实现 Mod 无法正常使用，请按照文档升级您的 Mod，或者使用 2.2.x 版本 RQAlpha</p>
<p>在通过 Mod 扩展 RQAlpha 的时候，由于 RQAlpha 直接定义了 <cite>Account</cite> 和 <cite>Position</cite> 相关的 Model, 增加新的 <cite>account</cite> 和 <cite>position</cite> 变得非常的困难，想扩展更多类型是一件很麻烦的事情，因此我们决定重构该模块从而解决这些问题。</p>
<p>详情请查看: <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/160">https://github.com/ricequant/rqalpha/issues/160</a></p>
<p>主要进行如下更改:</p>
<ul class="simple">
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">AbstractAccount</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">AbstractPosition</span></code>, 用户可以基于该抽象类进行扩展。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">const.ACCOUNT_TYPE</span></code> 修改为 <code class="code docutils literal notranslate"><span class="pre">const.DEFAULT_ACCOUNT_TYPE</span></code>，并且不再直接使用，您可以通过 <code class="code docutils literal notranslate"><span class="pre">Environment.get_instance().account_type_dict</span></code> 来获取包括 Mod 注入的账户类型。</p></li>
<li><p>原先所有使用 <cite>ACCOUNT_TYPE</cite> 作为 key 的地方，不再使用 Enum 类型作为 Key, 而是修改为对应 Enum 的 name 作为key。比如说原本使用 <code class="code docutils literal notranslate"><span class="pre">portfolio.accounts[ACCOUNT_TYPE.STOCK]</span></code> 更改为 <code class="code docutils literal notranslate"><span class="pre">portfolio.accounts['STOCK']</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Environment</span></code> 提供 <code class="code docutils literal notranslate"><span class="pre">set_account_model</span></code> | <code class="code docutils literal notranslate"><span class="pre">get_account_model</span></code> | <code class="code docutils literal notranslate"><span class="pre">set_position_model</span></code> | <code class="code docutils literal notranslate"><span class="pre">get_position_model</span></code> API 来注入 自定义Model。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Environment</span></code> 提供 <code class="code docutils literal notranslate"><span class="pre">set_smart_order</span></code> API 来注入自定义账户类型的智能下单函数，从而通过通用的 <code class="code docutils literal notranslate"><span class="pre">order</span></code> | <code class="code docutils literal notranslate"><span class="pre">order_to</span></code> API 便可以交易对应自定义账户类型。</p></li>
<li><p>RQAlpha 将已有的 AccountModel, PositionModel 和 API 抽离至 <cite>rqalpha_mod_sys_accounts</cite> 中，通过如下方式注入:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.account_model</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.position_model</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">api_future</span><span class="p">,</span> <span class="n">api_stock</span>


<span class="k">class</span> <span class="nc">AccountMod</span><span class="p">(</span><span class="n">AbstractMod</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">start_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">mod_config</span><span class="p">):</span>

        <span class="c1"># 注入 Account</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set_account_model</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">STOCK</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">StockAccount</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set_account_model</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">FUTURE</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">FutureAccount</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set_account_model</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">BENCHMARK</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">BenchmarkAccount</span><span class="p">)</span>

        <span class="c1"># 注入 Position</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set_position_model</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">STOCK</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">StockPosition</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set_position_model</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">FUTURE</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">FuturePosition</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set_position_model</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">BENCHMARK</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">StockPosition</span><span class="p">)</span>

        <span class="c1"># 注入 API</span>
        <span class="k">if</span> <span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">FUTURE</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">accounts</span><span class="p">:</span>
            <span class="c1"># 注入期货API</span>
            <span class="k">for</span> <span class="n">export_name</span> <span class="ow">in</span> <span class="n">api_future</span><span class="o">.</span><span class="n">__all__</span><span class="p">:</span>
                <span class="n">export_as_api</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">api_future</span><span class="p">,</span> <span class="n">export_name</span><span class="p">))</span>
            <span class="c1"># 注入 smart order</span>
            <span class="n">env</span><span class="o">.</span><span class="n">set_smart_order</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">FUTURE</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">api_future</span><span class="o">.</span><span class="n">smart_order</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">STOCK</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">accounts</span><span class="p">:</span>
            <span class="c1"># 注入股票API</span>
            <span class="k">for</span> <span class="n">export_name</span> <span class="ow">in</span> <span class="n">api_stock</span><span class="o">.</span><span class="n">__all__</span><span class="p">:</span>
                <span class="n">export_as_api</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">api_stock</span><span class="p">,</span> <span class="n">export_name</span><span class="p">))</span>
            <span class="c1"># 注入 smart order</span>
            <span class="n">env</span><span class="o">.</span><span class="n">set_smart_order</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">STOCK</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">api_stock</span><span class="o">.</span><span class="n">smart_order</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tear_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h2>2.2.7<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>解决当存在无效 Mod 时，RQAlpha 崩溃无法启动的问题</p></li>
<li><p>修复期货下单函数默认 style 为 None 导致报错退出的问题</p></li>
</ul>
</div>
<div class="section" id="id16">
<h2>2.2.5<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>增加 IPython Magic 方便在 IPython 中运行回测 <a class="reference external" href="https://github.com/ricequant/rqalpha/blob/master/docs/source/notebooks/run-rqalpha-in-ipython.ipynb">run-rqalpha-in-ipython.ipynb</a> 。运行完回测后，会将所有的 mod 的输出结果保存在 results 变量中，并且会将回测报告存储在 report 对象中。</p></li>
<li><p>修复系统异常、用户异常的区分判断</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">--source-code</span></code> 参数可以直接在命令行中传入策略源代码进行回测，这个选项目前主要给 IPython 使用。</p></li>
<li><p>对于 <code class="code docutils literal notranslate"><span class="pre">history_bars</span></code> 当 fields 为 None 的时候，指定为 [“datetime”, “open”, “high”, “low”, “close”, “volume”] 。</p></li>
<li><p>重构 rqalpha_mod_sys_funcat 的数据获取</p></li>
<li><p>修复 order 的 set_state 的 bug</p></li>
<li><p>优化分红计算</p></li>
<li><p>提取 inject_mod_commands 给 click 参数注入</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 加载 rqalpha 插件</span>
<span class="o">%</span><span class="n">load_ext</span> <span class="n">rqalpha</span>

<span class="c1"># 运行回测</span>
<span class="o">%%</span> <span class="n">rqalpha</span> <span class="o">-</span><span class="n">s</span> <span class="mi">20160101</span> <span class="o">-</span><span class="n">e</span> <span class="mi">20170101</span> <span class="o">-</span><span class="n">sc</span> <span class="mi">100000</span>
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h2>2.2.4<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>所有的下单函数进行了扩展，扩展如下:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 以 order_shares 举例，其他的下单函数同理。</span>
<span class="c1"># 原本的下单方式: 以 200 元的价格下单 100 股 000001.XSHE</span>
<span class="n">order_shares</span><span class="p">(</span><span class="s2">&quot;000001.XSHE&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">LimitOrder</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
<span class="c1"># 下单的如下方式都OK:</span>
<span class="n">order_shares</span><span class="p">(</span><span class="s2">&quot;000001.XSHE&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">order_shares</span><span class="p">(</span><span class="s2">&quot;000001.XSHE&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">LimitOrder</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
<span class="n">order_shares</span><span class="p">(</span><span class="s2">&quot;000001.XSHE&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">order_shares</span><span class="p">(</span><span class="s2">&quot;000001.XSHE&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">LimitOrder</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">buy_close</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">sell_close</span></code> API 增加 <code class="code docutils literal notranslate"><span class="pre">close_today</span></code> 参数，现在您现在可以指定发平今单了。</p></li>
<li><p>Breaking Change: 原本期货中的 <code class="code docutils literal notranslate"><span class="pre">buy_close</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">sell_close</span></code> API 返回的 <code class="code docutils literal notranslate"><span class="pre">Order</span></code> 对象。但实际交易过程中，涉及到昨仓今仓的时候，可能会存在发单被拒单的情况，RQAlpha 进行平昨/平今智能拆单的处理，因此在一些情况下会生成多个订单，对应也会返回一个订单列表。期货平仓更新的内容请参考 <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/116">Issue 116</a></p></li>
<li><p>Breaking Change: 取消 <code class="code docutils literal notranslate"><span class="pre">Order</span></code> | <code class="code docutils literal notranslate"><span class="pre">Trade</span></code> 对应的 <code class="code docutils literal notranslate"><span class="pre">__from_create__</span></code> 函数中 <code class="code docutils literal notranslate"><span class="pre">calendar_dt</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">trading_dt</span></code> 的传入，对接第三方交易源，构建订单和成交的 Mod 可能会产生影响，需要进行修改.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 原先的构建方式</span>
<span class="n">Order</span><span class="o">.</span><span class="n">__from_create__</span><span class="p">(</span>
  <span class="n">calendar_dt</span><span class="p">,</span>
  <span class="n">trading_dt</span><span class="p">,</span>
  <span class="n">order_book_id</span><span class="p">,</span>
  <span class="n">amount</span><span class="p">,</span>
  <span class="n">side</span><span class="p">,</span>
  <span class="n">style</span><span class="p">,</span>
  <span class="n">position_effect</span>
<span class="p">)</span>
<span class="c1">#修改为</span>
<span class="n">Order</span><span class="o">.</span><span class="n">__from_create__</span><span class="p">(</span>
  <span class="n">order_book_id</span><span class="p">,</span>
  <span class="n">amount</span><span class="p">,</span>
  <span class="n">side</span><span class="p">,</span>
  <span class="n">style</span><span class="p">,</span>
  <span class="n">position_effect</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><cite>iPython</cite> 更新至 6.0 版本以后不再支持 <cite>Python 2.x</cite> 导致在 <cite>Python 2.x</cite> 下安装RQAlpha 因为 <cite>line-profiler</cite> 依赖 <cite>iPython</cite> 的缘故而报错。目前增加了在 <cite>Python 2.x</cite> 下依赖 <cite>iPython 5.3.0</cite> 版本解决此问题。</p></li>
<li><p>不再提供 <cite>rqalpha-cmd</cite> 命令的扩展和注入，目前只有一个 entry point: <cite>rqalpha</cite> 第三方 Mod 可以扩展 <cite>rqalpha</cite> 命令。</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">from</span> <span class="pre">rqalpha</span> <span class="pre">import</span> <span class="pre">subscribe_event</span></code> 来支持事件订阅(暂时不增加到API中，您如果想在策略里使用，也需要主动 import 该函数), 如下示例所示:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rqalpha.api</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">rqalpha</span> <span class="kn">import</span> <span class="n">subscribe_event</span>


<span class="k">def</span> <span class="nf">on_trade_handler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="n">trade</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">trade</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">order</span>
    <span class="n">account</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">account</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Trade Handler&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">trade</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_order_handler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">order</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Order Handler&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">s1</span> <span class="o">=</span> <span class="s2">&quot;000001.XSHE&quot;</span>
    <span class="n">update_universe</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">s1</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">fired</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">subscribe_event</span><span class="p">(</span><span class="n">EVENT</span><span class="o">.</span><span class="n">TRADE</span><span class="p">,</span> <span class="n">on_trade_handler</span><span class="p">)</span>
    <span class="n">subscribe_event</span><span class="p">(</span><span class="n">EVENT</span><span class="o">.</span><span class="n">ORDER_CREATION_PASS</span><span class="p">,</span> <span class="n">on_order_handler</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">before_trading</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">handle_bar</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">bar_dict</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">fired</span><span class="p">:</span>
        <span class="n">order_percent</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">s1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">fired</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># rqalpha run -f ./rqalpha/examples/subscribe_event.py -s 2016-06-01 -e 2016-12-01 --stock-starting-cash 100000 --benchmark 000300.XSHG</span>
</pre></div>
</div>
<ul class="simple">
<li><p><cite>sys_stock_realtime</cite> 提供了一个行情下载服务，启动该服务，会实时往 redis 中写入全市场股票行情数据。多个 RQAlpha 可以连接该 redis 获取实时盘口数据，就不需要重复获取数据。详情参考文档 <a class="reference external" href="https://github.com/ricequant/rqalpha/blob/master/rqalpha/mod/rqalpha_mod_sys_stock_realtime/README.rst">sys stock realtime mod README</a></p></li>
<li><p>解决期货策略持仓到交割导致可用资金计算不准确的问题</p></li>
<li><p>解决 <cite>–plot</cite> 时候会报错退出的问题</p></li>
</ul>
</div>
<div class="section" id="id18">
<h2>2.2.2<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">run_file</span></code> | <code class="code docutils literal notranslate"><span class="pre">run_code</span></code> | <code class="code docutils literal notranslate"><span class="pre">run_func</span></code> API, 详情请参见 <a class="reference external" href="http://rqalpha.io/zh_CN/latest/intro/run_algorithm.html">多种方式运行策略</a></p></li>
<li><p>Breaking Change: 更改 <code class="code docutils literal notranslate"><span class="pre">AbstractStrategyLoader:load</span></code> 函数的传入参数，现在不需要 <code class="code docutils literal notranslate"><span class="pre">strategy</span></code> 了。</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">UserFuncStrategyLoader</span></code> 类</p></li>
<li><p>根据 <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/116">Issue 116</a> 增加如下内容:</p>
<ul>
<li><p><code class="code docutils literal notranslate"><span class="pre">POSITION_EFFECT</span></code> 增加 <code class="code docutils literal notranslate"><span class="pre">CLOSE_TODAY</span></code> 类型</p></li>
<li><p>增加调仓函数 <code class="code docutils literal notranslate"><span class="pre">order(order_book_id,</span> <span class="pre">quantity,</span> <span class="pre">price=None)</span></code> API</p>
<ul>
<li><p>如果不传入 price 则认为执行的是 MarketOrder 类型订单，否则下 LimitOrder 订单</p></li>
<li><p>期货</p>
<ul>
<li><p>quantity &gt; 0: 往 BUY 方向调仓 quantity 手</p></li>
<li><p>quantity &lt; 0: 往 SELL 方向调仓 quantity 手</p></li>
</ul>
</li>
<li><p>股票</p>
<ul>
<li><p>相当于 order_shares 函数</p></li>
</ul>
</li>
</ul>
</li>
<li><p>增加调仓函数 <code class="code docutils literal notranslate"><span class="pre">order_to(order_book_id,</span> <span class="pre">quantity,</span> <span class="pre">price=None)</span></code> API</p>
<ul>
<li><p>基本逻辑和 <code class="code docutils literal notranslate"><span class="pre">order</span></code> 函数一致</p></li>
<li><p>区别在于 quantity 表示调仓对应的最终仓位</p></li>
</ul>
</li>
<li><p>现有所有下单函数，增加 <cite>price</cite> option，具体行为和 <code class="code docutils literal notranslate"><span class="pre">order</span></code> | <code class="code docutils literal notranslate"><span class="pre">order_to</span></code> 一致</p></li>
</ul>
</li>
<li><p>Fix bug in <code class="code docutils literal notranslate"><span class="pre">all_instruments</span></code> <a class="reference external" href="https://github.com/ricequant/rqalpha/pull/123">PR 123</a></p></li>
<li><p>Fix “运行不满一天的情况下 sys_analyser 报 KeyError” <a class="reference external" href="https://github.com/ricequant/rqalpha/pull/118">PR 118</a></p></li>
<li><p>sys_analyser 生成 report 对应的字段进行调整，具体调整内容请查看 commit <a class="reference external" href="https://github.com/ricequant/rqalpha/commit/f6e4c24fde2f086cc09b45b2cc4d2cfe0cd9d19f">d9d19f</a></p></li>
</ul>
</div>
<div class="section" id="id21">
<h2>2.2.0<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">order</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">order_to</span></code> 高阶下单函数</p></li>
<li><p>更新数据源，现在使用原始数据和复权因子的方式进行回测</p></li>
<li><p>不再使用 <cite>ruamel.yaml</cite> 该库在某些情况下无法正确解析 yml 配置文件</p></li>
<li><p>解决 <cite>six</cite> 库依赖多次引用导致安装出错的问题</p></li>
<li><p>解决 <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">run</span></code> 的时候指定 <code class="code docutils literal notranslate"><span class="pre">-st</span></code> | <code class="code docutils literal notranslate"><span class="pre">--kind</span></code> 时报错的问题</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--security</span></code> / <code class="code docutils literal notranslate"><span class="pre">-st</span></code> 现在支持多种模式，可以使用 <code class="code docutils literal notranslate"><span class="pre">-st</span> <span class="pre">stock</span> <span class="pre">-st</span> <span class="pre">future</span></code> 也可以使用 <code class="code docutils literal notranslate"><span class="pre">-st</span> <span class="pre">stock_future</span></code> 来设置security</p></li>
<li><p>更新 BarDictPriceBoard <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/115">Issue 115</a></p></li>
<li><p>解决 <code class="code docutils literal notranslate"><span class="pre">print(context.portfolio)</span></code> 时因为调用了 <cite>abandon property</cite> 会报 warning 的问题 <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/114">Issue 114</a></p></li>
<li><p>解决 <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">mod</span> <span class="pre">install</span> <span class="pre">xx</span></code> 不存在的 Mod 也会导致 mod_config.yml 更新的问题 <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/111">Issue 111</a></p></li>
<li><p>解决 <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">plot</span></code> 无法画图的问题 <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/109">Issue 109</a></p></li>
</ul>
</div>
<div class="section" id="id22">
<h2>2.1.4<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>解决 history_bars 在 before_trading 获取的是未来数据的问题</p></li>
<li><p>解决 before_trading 获取结算价是当前交易日结算价的问题</p></li>
<li><p>增加 RQAlpha 向前兼容(0.3.x) <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/100">Issue 100</a></p></li>
<li><p>期货增加强平机制: 及当前账户权益&lt;=0时，清空仓位，资金置0 <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/108">Issue 108</a></p></li>
<li><p>解决回测时只有一个交易日时，只有回测数据显示的问题</p></li>
</ul>
</div>
<div class="section" id="id23">
<h2>2.1.3<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/101">Issue 101</a></p></li>
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/105">Issue 105</a></p></li>
<li><p>解决运行 RQAlpha 时缺少 <cite>six</cite> | <cite>requests</cite> 库依赖的问题</p></li>
<li><p>解决安装RQAlpha时在某些情况下报错的问题</p></li>
<li><p>解决第三方 Mod 安装后配置文件路径有误的问题</p></li>
<li><p>现在可以通过 <cite>rqalpha mod install -e .</cite> 的方式来安装依赖 Mod 了</p></li>
<li><p>现在运行策略时会检测当前目录是否存在 <cite>config.yml</cite> 或者 <cite>config.json</cite> 来作为配置文件</p></li>
<li><p>解决股票下单就存在 <cite>position</cite> 的问题，现在只有成交后才会产生 <cite>position</cite> 了。</p></li>
<li><p>修复 <cite>portfolio</cite> 和 <cite>future_account</cite> 计算逻辑的一些问题</p></li>
<li><p>修复 <cite>transaction_cost</cite> 在某个 position 清空以后计算不准确的问题</p></li>
<li><p>在信号模式下 <cite>price_limit</cite> 表示是否输出涨跌停买入/卖出的报警信息，但不会阻止其买入/卖出</p></li>
</ul>
</div>
<div class="section" id="id24">
<h2>2.1.2<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>提供 <code class="code docutils literal notranslate"><span class="pre">from</span> <span class="pre">rqalpha</span> <span class="pre">import</span> <span class="pre">cli</span></code> 方便第三方 Mod 扩展 <cite>rqalpha</cite> command</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">history_bars</span></code> 增加 <code class="code docutils literal notranslate"><span class="pre">include_now</span></code> option</p></li>
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/90">Issue 90</a></p></li>
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/94">Issue 94</a></p></li>
</ul>
</div>
<div class="section" id="id25">
<h2>2.1.0<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/87">Issue 87</a></p></li>
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/pull/89">Issue 89</a></p></li>
<li><p>Fix 无法通过 <code class="code docutils literal notranslate"><span class="pre">env.config.mod</span></code> 获取全部 <cite>mod</cite> 的配置信息</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">context.config</span></code> 来获取配置信息</p></li>
<li><p>提供 <code class="code docutils literal notranslate"><span class="pre">from</span> <span class="pre">rqalpha</span> <span class="pre">import</span> <span class="pre">export_as_api</span></code> 接口，方便扩展自定义 API</p></li>
</ul>
</div>
<div class="section" id="id26">
<h2>2.0.9<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/79">Issue 79</a></p></li>
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/82">Issue 82</a></p></li>
<li><p>Fix <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">cmd</span></code> 失效</p></li>
</ul>
</div>
<div class="section" id="id27">
<h2>2.0.8<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/81">Issue 81</a></p></li>
<li><p>解决 <cite>mod_config.yml</cite> 文件解析出错以后，所有的命令报错的问题</p></li>
<li><p>默认在 Python 2.x 下 <cite>sys.setdefaultencoding(“utf-8”)</cite></p></li>
<li><p>优化 <cite>UNIVERSE_CHANGED</cite> 事件，现在只有在universe真正变化时才触发</p></li>
</ul>
</div>
<div class="section" id="id28">
<h2>2.0.7<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/78">Issue 78</a></p></li>
<li><p><cite>is_st_stock</cite> | <cite>is_suspended</cite> 支持 <cite>count</cite> 参数</p></li>
<li><p>解决大量 Python 2.x 下中文乱码问题</p></li>
</ul>
</div>
<div class="section" id="id29">
<h2>2.0.6<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>解决在 Python 2.x 下安装 RQAlpha 提示 <cite>requirements-py2.txt Not Found</cite> 的问题</p></li>
<li><p>解决 <cite>Benchmark</cite> 无法显示的问题</p></li>
<li><p>解决 <cite>rqalpha mod list</cite> 显示不正确的问题</p></li>
<li><p>现在可以通过配置 <cite>base.extra_vars</cite> 向策略中预定义变量了。用法如下:</p></li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rqalpha</span> <span class="k">import</span> <span class="n">run</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;strategy_file&quot;</span><span class="p">:</span> <span class="s2">&quot;strategy.py&quot;</span><span class="p">,</span>
    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-06-01&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-07-01&quot;</span><span class="p">,</span>
    <span class="s2">&quot;stock_starting_cash&quot;</span><span class="p">:</span><span class="mi">100000</span><span class="p">,</span>
    <span class="s2">&quot;benchmark&quot;</span><span class="p">:</span> <span class="s1">&#39;000300.XSHG&#39;</span>
  <span class="p">},</span>
  <span class="s2">&quot;extra&quot;</span><span class="p">:{</span>
    <span class="s2">&quot;context_vars&quot;</span><span class="p">:{</span>
      <span class="s2">&quot;short&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;middle&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
      <span class="s2">&quot;long&quot;</span><span class="p">:</span><span class="mi">21</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">result_dict</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># 以下是策略代码:</span>

<span class="k">def</span> <span class="nf">handle_bar</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">short</span><span class="p">)</span>    <span class="c1"># 5</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">middle</span><span class="p">)</span>   <span class="c1"># 10</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">long</span><span class="p">)</span>     <span class="c1"># 21</span>
</pre></div>
</div>
</div>
<div class="section" id="id30">
<h2>2.0.1<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>修改配置的读取方式，不再从 <cite>~/.rqalpha/config.yml</cite> 读取自定义配置信息，而是默认从当前路径读取 <cite>config.yml</cite>，如果没找到，则会读取系统默认配置信息</p></li>
<li><p>现在不再对自定义信息进行版本检查</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">generate_config</span></code> 现在会生成包含所有默认系统配置信息的 <cite>config.yml</cite> 文件。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">RUN_TYPE</span></code> 增加 <code class="code docutils literal notranslate"><span class="pre">LIVE_TRADING</span></code></p></li>
<li><p>修复 <code class="code docutils literal notranslate"><span class="pre">history_bars</span></code> 获取日期错误产生的问题</p></li>
<li><p>修复执行 <code class="code docutils literal notranslate"><span class="pre">context.run_info</span></code> 会报错的问题</p></li>
<li><p>修复持久化报错的问题</p></li>
<li><p>增加 Order Persist 相关内容</p></li>
</ul>
</div>
<div class="section" id="id31">
<h2>2.0.0<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h2>
<p>2.0.0 详细修改内容请访问：<a class="reference external" href="https://github.com/ricequant/rqalpha/issues/65">RQAlpha 2.0.0</a></p>
<p><strong>Portfolio/Account/Position 相关</strong></p>
<ul class="simple">
<li><p>重新定义了 <code class="code docutils literal notranslate"><span class="pre">Portfolio</span></code>, <code class="code docutils literal notranslate"><span class="pre">Account</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">Position</span></code> 的角色和关系</p></li>
<li><p>删除大部分累计计算的属性，重新实现股票和期货的计算逻辑</p></li>
<li><p>现在只有在 <code class="code docutils literal notranslate"><span class="pre">Portfolio</span></code> 层级进行净值/份额的计算，Account级别不再进行净值/份额/收益/相关的计算</p></li>
<li><p>账户的恢复和初始化现在只需要 <code class="code docutils literal notranslate"><span class="pre">total_cash</span></code>, <code class="code docutils literal notranslate"><span class="pre">positions</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">backward_trade_set</span></code> 即可完成</p></li>
<li><p>精简 <code class="code docutils literal notranslate"><span class="pre">Position</span></code> 的初始化，可以从 <code class="code docutils literal notranslate"><span class="pre">real_broker</span></code> 直接进行恢复</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Account</span></code> 提供 <code class="code docutils literal notranslate"><span class="pre">fast_forward</span></code> 函数，账户现在可以从任意时刻通过 <code class="code docutils literal notranslate"><span class="pre">orders</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">trades</span></code> 快速前进至最新状态</p></li>
<li><p>如果存在 Benchmark， 则创建一个 <code class="code docutils literal notranslate"><span class="pre">benchmark_portfolio</span></code>, 其包含一个 <code class="code docutils literal notranslate"><span class="pre">benchmark_account</span></code></p></li>
<li><p>策略在调用 <code class="code docutils literal notranslate"><span class="pre">context.portfolio.positions[some_security]</span></code> 时候，如果 position 不存在，不再每次都创建临时仓位，而是会缓存，从而提高回测速度和性能</p></li>
<li><p>不再使用 <code class="code docutils literal notranslate"><span class="pre">clone</span></code> 方法</p></li>
<li><p>不再使用 <code class="code docutils literal notranslate"><span class="pre">PortfolioProxy</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">PositionProxy</span></code></p></li>
</ul>
<p><strong>Event 相关</strong></p>
<ul class="simple">
<li><p>规范 Event 的生成和相应逻辑, 使用 Event object 来替换原来的 Enum</p></li>
<li><p>抽离事件执行相关逻辑为 <code class="code docutils literal notranslate"><span class="pre">Executor</span></code> 模块</p></li>
</ul>
<p><strong>Mod 相关</strong></p>
<ul class="simple">
<li><p>规范化 Mod 命名规则，需要以 <cite>rqalpha_mod_xxx</cite> 作为 Mod 依赖库命名</p></li>
<li><p>抽离 <code class="code docutils literal notranslate"><span class="pre">slippage</span></code> 相关业务逻辑至 <code class="code docutils literal notranslate"><span class="pre">simulation</span> <span class="pre">mod</span></code></p></li>
<li><p>抽离 <code class="code docutils literal notranslate"><span class="pre">commission</span></code> 相关业务逻辑至 <code class="code docutils literal notranslate"><span class="pre">simulation</span> <span class="pre">mod</span></code></p></li>
<li><p>抽离 <code class="code docutils literal notranslate"><span class="pre">tax</span></code> 相关业务逻辑至 <code class="code docutils literal notranslate"><span class="pre">simulation</span> <span class="pre">mod</span></code></p></li>
<li><p><cite>rqalpha mod list</cite> 命令现在可以格式化显示 Mod 当前的状态了</p></li>
</ul>
<p><strong>Environment 和 ExecutionContext 相关</strong></p>
<ul class="simple">
<li><p>现在 <code class="code docutils literal notranslate"><span class="pre">ExecutionContext</span></code> 只负责上下文相关的内容，不再可以通过 <code class="code docutils literal notranslate"><span class="pre">ExecutionContext</span></code> 访问其他成员变量。</p></li>
<li><p>扩展了 <code class="code docutils literal notranslate"><span class="pre">Environment</span></code> 的功能，RQAlpha 及 Mod 均可以直接通过 <code class="code docutils literal notranslate"><span class="pre">Environment.get_instance()</span></code> 来获取到环境中核心模块的引用</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Environment</span></code> 还提供了很多常用的方法，具体请直接参考代码</p></li>
</ul>
<p><strong>配置及参数相关</strong></p>
<ul class="simple">
<li><p>重构了配置相关的内容，<cite>~/.rqalpha/config.yml</cite> 现在类似于 Sublime/Atom 的用户配置文件，用于覆盖默认配置信息，因此只需要增加自定义配置项即可，不需要全部的配置内容都存在</p></li>
<li><p>将Mod自己的默认配置从配置文件中删除，放在Mod中自行管理和维护</p></li>
<li><p>独立存在 <cite>~/.rqalpha/.mod_conifg.yml</cite>, 提供 <cite>rqalpha mod install/uninstall/enable/disable/list</cite> 命令，RQAlpha 会通过该配置文件来对Mod进行管理。</p></li>
<li><p>抽离 <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">run</span></code> 的参数，将其中属于 <cite>Mod</cite> 的参数全部删除，取代之为Mod提供了参数注入机制，所以现在 <cite>Mod</cite> 可以自行决定是否要注入参数或者命令来扩展 RQAlpha 的功能</p></li>
<li><p>提供了 <code class="code docutils literal notranslate"><span class="pre">rqalpha-cmd</span></code> 命令，<cite>Mod</cite> 推荐在该命令下注入自己的命令来实现功能扩展</p></li>
<li><p>不再使用 <cite>–strategy-type</cite>， 改为使用 <cite>–security</cite> 选项</p></li>
<li><p><cite>–output-file</cite> | <cite>–report</cite> | <cite>–plot</cite> | <cite>–plot-save`参数 转移至 `sys_analyser</cite> Mod 中</p></li>
<li><p><cite>plot</cite> | <cite>report</cite> 命令，转移至 <cite>sys_analyser</cite> Mod 中</p></li>
<li><p><cite>–signal</cite> | <cite>–slippage</cite> | <cite>–commission-multiplier</cite> | <cite>–matching-type</cite> | <cite>–rid</cite> 转移至 <cite>sys_simulation</cite> Mod 中</p></li>
</ul>
<p><strong>Risk 计算</strong></p>
<ul class="simple">
<li><p>修复 <a class="reference external" href="https://www.ricequant.com/api/python/chn#backtest-results-factors">tracking error</a> 计算错误</p></li>
<li><p>修改 <a class="reference external" href="https://www.ricequant.com/api/python/chn#backtest-results-risk-adjusted-returns">sharpe</a> , <a class="reference external" href="https://www.ricequant.com/api/python/chn#backtest-results-risk-adjusted-returns">sortino</a> , <a class="reference external" href="https://www.ricequant.com/api/python/chn#backtest-results-risk-adjusted-returns">information ratio</a> , <a class="reference external" href="https://www.ricequant.com/api/python/chn#backtest-results-returns">alpha</a> 计算逻辑。参考 <a class="reference external" href="https://gladmainnew.morningstar.com/directhelp/Methodology_StDev_Sharpe.pdf">晨星</a> 的方法, 先计算单日级别指标, 再进行年化。与原本直接基于年化值计算相比, 在分析时间较短的情况下, 新的指标计算结果会系统性低于原指标结果。</p></li>
<li><p>引入单日无风险利率作为中间变量计算上述指标。单日无风险利率为通过 <a class="reference external" href="http://yield.chinabond.com.cn/cbweb-mn/yield_main">中国债券信息网</a> 获取得到对应期限的年化国债到期收益率除以244得到</p></li>
<li><p>修改指标说明若干</p></li>
</ul>
<p><strong>其他</strong></p>
<ul class="simple">
<li><p>修改了 <code class="code docutils literal notranslate"><span class="pre">Order</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">Trade</span></code> 的字段和函数，使其更通用</p></li>
<li><p>为 <code class="code docutils literal notranslate"><span class="pre">RqAttrDict</span></code> 类增加 <code class="code docutils literal notranslate"><span class="pre">update</span></code> 方法，现在支持动态更新了</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">arg_checker</span></code> 增加 <code class="code docutils literal notranslate"><span class="pre">is_greater_or_equal_than</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">is_less_or_equal_than</span></code> 函数</p></li>
<li><p>删除 <code class="code docutils literal notranslate"><span class="pre">DEFAULT_FUTURE_INFO</span></code> 变量，现在可以直接通过 <code class="code docutils literal notranslate"><span class="pre">data_proxy</span></code> 获取相关数据</p></li>
<li><p>通过 <a class="reference external" href="https://github.com/Qix-/better-exceptions">better_exceptions</a> 提供更好的错误堆栈提示体验</p></li>
<li><p>对字符串的处理进行了优化，现在可以正确在 Python2.x/3.x 下显示中文了</p></li>
<li><p>修复 <code class="code docutils literal notranslate"><span class="pre">update_bundle</span></code> 直接在代码中调用会报错的问题</p></li>
<li><p>增加对于下单量为0的订单过滤，不再会创建订单，也不再会输出警报日志</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">is_suspended</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">is_st_stock</span></code> API 的支持</p></li>
</ul>
</div>
<div class="section" id="id35">
<h2>0.3.14<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Hotfix <code class="code docutils literal notranslate"><span class="pre">UnboundLocalError:</span> <span class="pre">local</span> <span class="pre">variable</span> <span class="pre">'signature'</span> <span class="pre">referenced</span> <span class="pre">before</span> <span class="pre">assignment</span></code></p></li>
</ul>
</div>
<div class="section" id="id36">
<h2>0.3.13<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>增加股票裸做空的配置参数 <code class="code docutils literal notranslate"><span class="pre">--short-stock</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">POSITION_EFFECT</span></code> 增加 <code class="code docutils literal notranslate"><span class="pre">CLOSE_TODAY</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">ExecutionContext</span></code> 增加 <code class="code docutils literal notranslate"><span class="pre">get_current_close_price</span></code> <code class="code docutils literal notranslate"><span class="pre">get_future_commission_info</span></code>  <code class="code docutils literal notranslate"><span class="pre">get_future_margin</span></code> <code class="code docutils literal notranslate"><span class="pre">get_future_info</span></code> 函数</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">RQInvalidArgument</span></code> 来处理用户策略代码异常的问题</p></li>
<li><p>现在可以正确提示期货主力连续合约和指数连续合约在回测和模拟中的报错信息了</p></li>
<li><p>现在以 <code class="code docutils literal notranslate"><span class="pre">handle_tick(context,</span> <span class="pre">tick)</span></code> 的方式支持tick级别的API支持(未来可能会修改)</p></li>
<li><p>现在回测时的 <code class="code docutils literal notranslate"><span class="pre">before_trading</span></code> 函数输出的时间提前到开盘前半小时</p></li>
</ul>
</div>
<div class="section" id="id37">
<h2>0.3.12<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>优化 <cite>setup.py</cite> 脚本，只有在 python 2 环境下才安装兼容性依赖库</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">install/uninstall/list/enable/disable</span></code> 命令</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">EVENT.POST_SYSTEM_RESTORED</span></code> 事件</p></li>
<li><p>增加 净值和份额的支持，现在的收益和Analyser的计算都是基于净值了。</p></li>
<li><p>在 AnalyserMod 输出的 Trade 中增加 <code class="code docutils literal notranslate"><span class="pre">side</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">position_effect</span></code></p></li>
<li><p>修复 <code class="code docutils literal notranslate"><span class="pre">total_orders</span></code> 计算错误</p></li>
<li><p>修复 <code class="code docutils literal notranslate"><span class="pre">inpsect.signature</span></code> 在 python 2.x 报错的问题。</p></li>
</ul>
</div>
<div class="section" id="id38">
<h2>0.3.11<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>更新本地化翻译，修改系统提示，支持多语言</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">--locale</span></code> 默认为 <code class="code docutils literal notranslate"><span class="pre">cn</span></code> (中文), 支持 <code class="code docutils literal notranslate"><span class="pre">cn</span> <span class="pre">|</span> <span class="pre">en</span></code> (中文 | 英文)</p></li>
<li><p>修复 <code class="code docutils literal notranslate"><span class="pre">main.run</span></code> 返回值中 <code class="code docutils literal notranslate"><span class="pre">stock_position</span></code> 为 <code class="code docutils literal notranslate"><span class="pre">None</span></code> 的问题</p></li>
<li><p>修复 Windows Python 2.7 下中文显示乱码的问题</p></li>
</ul>
</div>
<div class="section" id="id39">
<h2>0.3.10<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">config.yml</span></code> 的版本号检查及相关流程</p></li>
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">plot</span></code> 关于中文字体的校验，如果系统没有中文字体，则显示英文字段</p></li>
<li><p>修正 <code class="code docutils literal notranslate"><span class="pre">Benchmark</span></code> 在不设置时某些情况下会导致运行失败的错误</p></li>
<li><p>修正 <code class="code docutils literal notranslate"><span class="pre">inspect.unwrap</span></code> 在 Python 2.7 下不支持的兼容性问题</p></li>
<li><p>修正 <code class="code docutils literal notranslate"><span class="pre">numpy</span></code> 在某些平台下没有 <cite>float128</cite> 引起的报错问题</p></li>
</ul>
</div>
<div class="section" id="id40">
<h2>0.3.9<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">--disable-user-system-log</span></code> 参数，可以独立关闭回测过程中因策略而产生的系统日志</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--log-level</span></code> 现在可以正确区分不同类型的日志，同时增加 <code class="code docutils literal notranslate"><span class="pre">none</span></code> 类型，用来关闭全部日志信息。</p></li>
<li><p>在不指定配置文件的情况下，默认会调用 <code class="code docutils literal notranslate"><span class="pre">~/.rqalpha/config.yml</span></code> 文件</p></li>
<li><p>支持 <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">generate_config</span></code> 命令来获取默认配置文件</p></li>
<li><p>指定策略类型不再使用 <code class="code docutils literal notranslate"><span class="pre">--kind</span></code> 参数，替换为 <code class="code docutils literal notranslate"><span class="pre">--strategy-type</span></code> 和配置文件呼应</p></li>
<li><p>重构 <code class="code docutils literal notranslate"><span class="pre">events.py</span></code>，现在可以更好的支持基于事件的模块编写了</p></li>
<li><p>将风险指标计算独立成 <code class="code docutils literal notranslate"><span class="pre">analyser</span></code> Mod</p></li>
<li><p>将事前风控相关内容独立成 <code class="code docutils literal notranslate"><span class="pre">risk_manager</span></code> Mod</p></li>
<li><p>将 <cite>回测</cite> 和 <cite>实盘模拟</cite> 相关功能独立成 <code class="code docutils literal notranslate"><span class="pre">simulation</span></code> Mod</p></li>
</ul>
</div>
<div class="section" id="id41">
<h2>0.3.8<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>增加几个 technical analysis 的 examples 和自动化测试</p></li>
<li><p>修复一些在 Python 2 下运行的 bug</p></li>
</ul>
</div>
<div class="section" id="id42">
<h2>0.3.7<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">-mc</span></code> / <code class="code docutils literal notranslate"><span class="pre">--mod-config</span></code> 参数来传递参数到 mod 中</p></li>
<li><p>增加了 simple_stock_realtime_trade, progressive_output_csv，funcat_api 几个 DEMO mod 供开发者参考开发自己的 mod</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">update_bundle</span></code> 移到 <code class="code docutils literal notranslate"><span class="pre">main.py</span></code> 中，方便直接从代码中调用 <code class="code docutils literal notranslate"><span class="pre">update_bundle</span></code></p></li>
<li><p>增加了一些自动化的测试用例</p></li>
</ul>
</div>
<div class="section" id="id43">
<h2>0.3.6<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>support auto test with Travis [python 2.7 3.4 3.5 3.6]</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">rqalpha.run</span></code> 现在支持直接传入 <code class="code docutils literal notranslate"><span class="pre">source_code</span></code> 了</p></li>
<li><p>支持 <code class="code docutils literal notranslate"><span class="pre">rqalpha.update_bundle</span></code> 函数</p></li>
</ul>
</div>
<div class="section" id="id44">
<h2>0.3.5<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>增加 <code class="code docutils literal notranslate"><span class="pre">from</span> <span class="pre">rqalpha</span> <span class="pre">import</span> <span class="pre">run</span></code> 接口，现在可以很方便的直接在程序中调用RQAlpha 回测了。</p></li>
</ul>
</div>
<div class="section" id="id45">
<h2>0.3.4<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>本地化模块更具有扩展性</p></li>
<li><p>修改 <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">update_bundle</span></code> 的目录结构，现在是在指定目录下生成一个 bundle 文件，而不再会直接删除当前文件夹内容了。</p></li>
</ul>
</div>
<div class="section" id="id46">
<h2>0.3.3<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>解决 <code class="code docutils literal notranslate"><span class="pre">rqalpha</span> <span class="pre">examples</span> <span class="pre">-d</span> <span class="pre">.</span></code> 无样例策略生成的问题</p></li>
</ul>
</div>
<div class="section" id="id47">
<h2>0.3.2<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>解决 Windows 10 下 matplotlib 中文字体显示乱码的问题</p></li>
<li><p>解决 Windows 下 set_locale error 的问题</p></li>
</ul>
</div>
<div class="section" id="id48">
<h2>0.3.1<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>增加 Python 2 的支持</p></li>
</ul>
</div>
<div class="section" id="id49">
<h2>0.3.0<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>支持多周期回测扩展(虽然只有日线数据，但是结构上是支持不同周期的回测和实盘的)</p></li>
<li><p>支持期货策略</p></li>
<li><p>支持混合策略(股票和期货混合)</p></li>
<li><p>支持多种参数配置方式</p></li>
<li><p>抽离接口层，数据源、事件源、撮合引擎、下单模块全部可以替换或扩展。</p></li>
<li><p>完善事件定义，采取 pub/sub 模式，可以非常简答的在 RQAlpha 中添加 hook。</p></li>
<li><p>增加 Mod 机制，极大的增加了 RQAlpha 的扩展性，使其可以轻松完成程序化交易过程中所产生的的特定需求。</p></li>
</ul>
</div>
<div class="section" id="id50">
<h2>0.0.53<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>完善了回测结果显示</p></li>
<li><p>修正了 Risk 计算和 Benchmark 计算</p></li>
</ul>
</div>
<div class="section" id="id51">
<h2>0.0.20<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>增加会回测进度显示开关</p></li>
<li><p>完善了回测结果显示</p></li>
</ul>
</div>
<div class="section" id="id52">
<h2>0.0.19<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>在 <code class="code docutils literal notranslate"><span class="pre">handle_bar</span></code> 前用当前的数据更新 portfolio 和 position，因为 ricequant.com 是这样做的。</p></li>
</ul>
</div>
<div class="section" id="id53">
<h2>0.0.18<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>修复了分红计算</p></li>
</ul>
</div>
<div class="section" id="id54">
<h2>0.0.16<a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>用户可以通过 context 设置 slippage/commission/benchmark</p></li>
<li><p>增加了 scheduler</p></li>
</ul>
</div>
<div class="section" id="id55">
<h2>0.0.15<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>修复 history 在 before_trading 调用</p></li>
<li><p>增加 api 的 phase 检查</p></li>
</ul>
</div>
<div class="section" id="id56">
<h2>0.0.14<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>修改支持 python2</p></li>
</ul>
</div>
<div class="section" id="id57">
<h2>0.0.12<a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>修正了 Risk 计算，使用合理的年化收益计算方法</p></li>
<li><p>格式化代码符合 pep8</p></li>
<li><p>更新 requirements.txt</p></li>
</ul>
</div>
<div class="section" id="id58">
<h2>0.0.9<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>增加了数据下载</p></li>
<li><p>修正了 Risk 计算</p></li>
<li><p>增加了 instrument</p></li>
<li><p>增加了 position 的 <code class="code docutils literal notranslate"><span class="pre">market_value</span></code> 和 <code class="code docutils literal notranslate"><span class="pre">value_percent</span></code></p></li>
</ul>
</div>
<div class="section" id="id59">
<h2>0.0.2<a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>增加了日线回测</p></li>
<li><p>去掉了涨跌停检查</p></li>
<li><p>增加了分红处理</p></li>
<li><p>运行参数如下:</p></li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 生成sample策略</span>
<span class="n">rqalpha</span> <span class="n">generate_examples</span> <span class="o">-</span><span class="n">d</span> <span class="o">./</span>

<span class="c1"># 运行回测</span>
<span class="n">rqalpha</span> <span class="n">run</span> <span class="o">-</span><span class="n">f</span> <span class="n">examples</span><span class="o">/</span><span class="n">simple_macd</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">s</span> <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="o">-</span><span class="n">e</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">a</span><span class="o">.</span><span class="n">pkl</span>
</pre></div>
</div>
</div>
<div class="section" id="id60">
<h2>0.0.1<a class="headerlink" href="#id60" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>搭建基本的框架，增加基本的 unittest</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="development/collecting_logs.html" class="btn btn-neutral float-left" title="收集策略日志" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 
      <span class="lastupdated">
        Last updated on Aug 30, 2019.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 
<script type="text/javascript">
    console.log("RQAlpha Powered By RiceQuant.");
</script>


</body>
</html>